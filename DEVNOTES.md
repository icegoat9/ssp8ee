Keeping a rough scratchpad of some running dev notes here, rather than in the [README.md](README.md) which was already too long.

## PICO8 Edu Edition @URL Format

Some notes from just a few hours of trial-and-error investigating what this format is.

`https://www.pico-8-edu.com/?c=FOO&g=BAR`

Where, with a few caveats, FOO is the b64 urlsafe-encoded code and BAR is the encoded spritesheet data. `&g=...` can be omitted if not used.

By looking at how the encoded @URL changes if I change single characters or pixels in PICO8, there's some compression (some form of run-length encoding at least for sprite data-- most obvious if you have a row of pixels of the same color) applied to the code before b64 encoding. However, the P8 Edu Edition can accept uncompressed data in the URL as well, which is what I started with just to get something working quickly.

### Spritesheet

Using the SAVE @URL command on some simple carts and looking at the generated URL, I see that:

* A single dark blue (color 1) spritesheet pixel encodes as `B` (the b64 encoding for value 1)
* A row of 8 pixels in colors 1-8 encodes as `BCDEFGHI` (b64 for 1-8). Interestingly, this isn't b64 encoding the spritesheet memory (e.g. it doesn't seem to be packing the data into a series of 8-bit bytes and then b64 encoding that into 4/3 as many 6-bit characters), but instead is using the b64 mapping on each pixel. That's simpler to read, at least.
* However, a row of 8 dark blue (1) pixels encodes as `xE` rather than `BBBBBBBB`. There's some run-length encoding going on that stores identical consecutive pixels (only) in a more compact format, as a row of 8 alternating pixel values of 1,2,1,2,1,2,1,2 is encoded as the uncompressed `BCBCBCBC`.

| Row of 8 sprite pixels | @URL b64 encoding | Decimal | Binary (tbd order) |
--------------
| 1 | B | 1 | |
| 2 | C | 2 | |
| 12121212 | BCBCBCBC |  | |
| 11 | R | 17 | 010001 |
| 111 | h |  31 | 100001 |
| 1111 | xA | 49,0 | 110001,0 |
| 11111 | xB | 49,1 | |
| 111111 | xC | 49,2 | |
| 11111111 | xE | 49,4 | |


### b64 error?

I had this wrapper mostly working, but was seeing errors where '>' and '?' characters (CHRs 62 and 63) in code were sometimes (but not always) swapped when opening a cart link generated by this spreadsheet in Education Edition. Adding or removing whitespace in the cart seemed to make the problem go away?! Eventually I discoverd that PICO8's @URL format seems to swap the meaning of '-' and '_' in its b64 encoding compared to the typical urlsafe encoding. Those represent values 62 and 63, so we'd expect a common decoding issue when > or ? characters line up with three-character boundaries in the input data (we'd also see this for other combinations of characters but mostly less used extended characters). I don't know if this is some light obfuscation or was unintentional, but I've adjusted this wrapper to match what PICO8's URL format seems to expect.

## Google Sheets notes-to-self

It's possible to build a lot of functionality in spreadsheets (for example, a string->b64 encoder), even without incorporating scripting (AppScript, VBA, etc). A few more modern spreadsheet functions have made that easier than it was a decade ago:

* `MAP()` and `LAMBDA()` are powerful and flexible alternatives to array formulas or having sheets of 'intermediate data' that later formulas process.

  * I haven't figured out if there's a cleaner way to split a string into an array of character values but this is fairly concise (assuming we can choose some character like "¶" we know isn't naturally in the input):

```
chararray = MAP(SPLIT(REGEXREPLACE(input,,"¶"),"¶"),lambda(x,CODE(x)))
```

* The `LET()` function in Google Sheets is very convenient for avoiding hard-to-read and error-prone copy and paste within formulas, avoiding the need for various 'intermediate value' dummy cells, and can be abused as a way to add quick comments within a formula. Why write:
```
mid("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-",a,1) & 
mid("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-",b,1) & 
mid("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-",c,1) &
mid("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-",d,1)
```
when you can write something like:
```
let(b64map,let(comment,"b64 encoding (nonstandard with -,_ swapped)",
    "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-"),
mid(b64map,a,1) & mid(b64map,b,1) & mid(b64map,c,1) & mid(b64map,d,1))
```

* `QUERY()` is also very powerful + flexible in certain circumstances though I don't use it in this project.